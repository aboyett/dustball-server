<% # from https://css-tricks.com/how-to-make-a-modern-dashboard-with-nvd3-js/ %>

<div id="averageDegreesLineChart" class='with-3d-shadow with-transitions averageDegreesLineChart'>
  <svg></svg>
</div>

<div id="pm24HoursLineChart" class='with-3d-shadow with-transitions averageDegreesLineChart'>
  <svg></svg>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.2/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.6/nv.d3.js"></script>

<script>
  var PM_2_HOURS_JSON = [
  {
    key: "PM 1.0",
    values: [
  <% @samples_2hours.each do |sample|
           unless sample.pm1 == 0 && sample.pm25 == 0 && sample.pm10 == 0 
    %>
     { "x": <%= sample.created_at.to_i %>, "y": <%= sample.pm1 %> },
   <%   end
	end
    %>
     ]
  },

  {
  key: "PM 2.5",
  values: [
  <% @samples_2hours.each do |sample|
           unless sample.pm1 == 0 && sample.pm25 == 0 && sample.pm10 == 0 
    %>
     { "x":  <%= sample.created_at.to_i %>, "y": <%= sample.pm25 %> },
   <%   end
	end
    %>
  ]
  },

  {
  key: "PM 10.0",
  values: [
  <% @samples_2hours.each do |sample|
           unless sample.pm1 == 0 && sample.pm25 == 0 && sample.pm10 == 0 
    %>
     { "x":  <%= sample.created_at.to_i %>, "y": <%= sample.pm10 %> },
   <%   end
	end
    %>
  ]
  }
  ];

  var PM_24_HOURS_JSON = [
  {
    key: "PM 1.0",
    values: [
  <% @samples_24hours.each do |sample|
           unless sample.pm1 == 0 && sample.pm25 == 0 && sample.pm10 == 0 
    %>
     { "x":  <%= sample.created_at.to_i %>, "y": <%= sample.pm1 %> },
   <%   end
	end
    %>
     ]
  },

  {
  key: "PM 2.5",
  values: [
  <% @samples_24hours.each do |sample|
           unless sample.pm1 == 0 && sample.pm25 == 0 && sample.pm10 == 0 
    %>
     { "x": <%= sample.created_at.to_i %>, "y": <%= sample.pm25 %> },
   <%   end
	end
    %>
  ]
  },

  {
  key: "PM 10.0", 
  values: [
  <% @samples_24hours.each do |sample|
           unless sample.pm1 == 0 && sample.pm25 == 0 && sample.pm10 == 0 
    %>
     { "x": <%= sample.created_at.to_i %>, "y": <%= sample.pm10 %> },
   <%   end
	end
    %>
  ]
  }
  ];


  nv.addGraph(function () {
   var chart = nv.models.lineChart()    // Initialise the lineChart object.
                                      .height(400)
                                    .useInteractiveGuideline(true); // Turn on interactive guideline (tooltips)
  
  chart.xAxis.axisLabel('Time'); // Set the label of the xAxis (Vertical)
  chart.yAxis.axisLabel('Particle count') // Set the label of the xAxis (Horizontal)
                    .tickFormat(d3.format('.02f')); // Rounded Numbers Format.
  
  d3.select('#averageDegreesLineChart svg') // Select the ID of the html element we defined earlier.
      .datum(PM_2_HOURS_JSON) // Pass in the JSON
      .transition().duration(500)    // Set transition speed
      .style({ height: "400px" })
      .call(chart); // Call & Render the chart

  nv.utils.windowResize(chart.update); // Intitiate listener for window resize so the chart responds and changes width.


   var chart24 = nv.models.lineChart()    // Initialise the lineChart object.
                                      .height(400)
                                    .useInteractiveGuideline(true); // Turn on interactive guideline (tooltips)
  
  chart24.xAxis.axisLabel('Time'); // Set the label of the xAxis (Vertical)
  chart24.yAxis.axisLabel('Particle count') // Set the label of the xAxis (Horizontal)
                    .tickFormat(d3.format('.02f')); // Rounded Numbers Format.
  
  d3.select('#pm24HoursLineChart svg') // Select the ID of the html element we defined earlier.
      .datum(PM_24_HOURS_JSON) // Pass in the JSON
      .transition().duration(500)    // Set transition speed
      .style({ height: "400px" })
      .call(chart24); // Call & Render the chart

  nv.utils.windowResize(chart.update); // Intitiate listener for window resize so the chart responds and changes width.

  return;
  });

</script>
